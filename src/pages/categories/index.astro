import PageLayout from "@/layouts/PageLayout.astro";
import { getCollection } from "astro:content";
import { CATEGORY_LINKS, CATEGORY_OPTIONS } from "@/utils/categories";

const posts = await getCollection("blogs");

const summaries: Record<(typeof CATEGORY_OPTIONS)[number], string> = {
  "Sociedade & Geopolítica": "Conflitos, história, cultura e o mundo que nos cerca.",
  "Filosofia & Literatura": "Ideias, ensaio, crítica e leituras que mudam o olhar.",
  "Tecnologia & Dados": "Infra, IA, ciência de dados e os sistemas que habitamos.",
  "Xadrez & Hobbies": "Estratégia, jogos, treino e interesses pessoais.",
  "Arte & Cultura": "Cinema, música, design, movimentos e repertório visual.",
  "Miscelânea (off-topic)": "Curiosidades e textos que não cabem em outra caixa.",
};

const categories = CATEGORY_LINKS.map(({ label, slug }) => ({
  label,
  slug,
  summary: summaries[label],
  count: posts.filter((post) => (post.data.category ?? "") === label).length,
}));
---

<PageLayout title="Tópicos">
  <section class="flex flex-col space-y-3 md:space-y-4">
    <div class="mx-auto w-full md:max-w-[46rem]">
      <p class="text-[12px] font-semibold uppercase tracking-[0.16em] text-muted-text">TÓPICOS</p>
    </div>

    <div class="mx-auto w-full md:max-w-[46rem]">
      <ul class="grid gap-6 md:grid-cols-2">
        {categories.map((category) => (
          <li>
            <a href={`/categories/${category.slug}`} class="flex flex-col justify-between rounded border border-border-ink/70 bg-card-bg px-6 py-6 ui-transition hover:border-border-ink/90 hover:bg-surface-bg">
              <div>
                <p class="text-[11px] font-semibold uppercase tracking-[0.16em] text-muted-text">
                  {category.count} post{category.count === 1 ? "" : "s"}
                </p>
                <h2 class="text-xl font-semibold text-primary-text">{category.label}</h2>
                <p class="text-sm text-secondary-text">{category.summary}</p>
              </div>
              <span class="mt-5 text-xs font-semibold uppercase tracking-[0.16em] text-secondary-text">
                Ver posts
              </span>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </section>
</PageLayout>
