---
import PageLayout from "@/layouts/PageLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import { CATEGORY_OPTIONS } from "@/utils/categories";
import PostListItem from "@/components/PostListItem.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blogs");
  return CATEGORY_OPTIONS.map((label) => {
    const items = posts
      .filter((p) => p.data.category === label)
      .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
    return { params: { category: label.toLowerCase() }, props: { label, items } };
  });
}

const { label, items }: { label: (typeof CATEGORY_OPTIONS)[number]; items: CollectionEntry<"blogs">[] } = Astro.props;
---

<PageLayout>
  <section class="flex flex-col space-y-3 md:space-y-4">
    <!-- rótulo alinhado à mesma régua dos cards -->
    <div class="mx-auto w-full md:max-w-[46rem] lg:max-w-[50rem] xl:max-w-[52rem]">
      <p class="text-[12px] font-semibold uppercase tracking-[0.16em] text-muted-text">
        CATEGORY @ {label.toUpperCase()}
      </p>
    </div>

    {items.length ? (
      <ul class="space-y-3 md:space-y-4">
        {items.map((post) => (
          <li class="py-0 first:pt-0">
            <PostListItem post={post} />
          </li>
        ))}
      </ul>
    ) : (
      <p class="text-secondary-text">No posts in this category yet.</p>
    )}
  </section>
</PageLayout>
