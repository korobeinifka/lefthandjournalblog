---
import PageLayout from "@/layouts/PageLayout.astro";
import PublishingWorkspace from "@/components/Publishing/PublishingWorkspace.svelte";
import type { PublishingPost } from "@/components/Publishing/types";
import { CATEGORY_OPTIONS } from "@/utils/categories";
import { getCollection } from "astro:content";

const rawPosts = await getCollection("blogs");
const now = new Date();

const initialPosts: PublishingPost[] = rawPosts.map((entry) => ({
  id: entry.id,
  slug: entry.slug,
  title: entry.data.title,
  description: entry.data.description,
  category: entry.data.category,
  pubDate: entry.data.pubDate.toISOString(),
  heroImage: entry.data.heroImage ?? undefined,
  heroImageAlt: entry.data.heroImageAlt ?? undefined,
  status: entry.data.pubDate.valueOf() > now.valueOf() ? "scheduled" : "published",
  body: entry.body,
}));
---

<PageLayout
  title="Publishing"
  description="Compose, review, and release stories without breaking the magazine's calm cadence."
>
  <section class="mx-auto max-w-6xl py-12 sm:py-16">
    <div class="space-y-12 rounded-3xl border border-border-ink/70 bg-card-bg/95 p-8 shadow-lg shadow-black/5 sm:p-12">
      <header class="max-w-3xl space-y-4">
        <p class="text-xs font-semibold uppercase tracking-[0.35em] text-muted-text">
          Publishing studio
        </p>
        <h1 class="font-display text-4xl leading-tight text-primary-text sm:text-5xl">
          Keep the editorial rhythm steady
        </h1>
        <p class="text-lg text-secondary-text">
          Draft essays, adjust typography, and move calmly from idea to publication. Every control below mirrors the
          magazine's layout so you can focus on the writing.
        </p>
      </header>

      <PublishingWorkspace
        client:load
        initialPosts={initialPosts}
        categoryOptions={[...CATEGORY_OPTIONS]}
      />
    </div>
  </section>
</PageLayout>
